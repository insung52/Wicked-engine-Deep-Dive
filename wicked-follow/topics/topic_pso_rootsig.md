# Topic: PSO & Root Signature (íŒŒì´í”„ë¼ì¸ ìƒíƒœ ê°ì²´)

## ê°œìš”

Pipeline State Object(PSO)ì™€ Root Signature ê´€ë ¨ ê°œì„  ì‚¬í•­ë“¤.

## ê´€ë ¨ ì»¤ë°‹

| ìˆœì„œ | ì»¤ë°‹ | ë‚ ì§œ | í•µì‹¬ ë³€ê²½ |
|------|------|------|----------|
| 1 | [dx1 #11 `8582ea3d`](https://github.com/insung52/Wicked-engine-Deep-Dive/blob/main/wicked-follow/dx_1/11_8582ea3d_pso_binding_optimization.md) | 2025-04-28 | PSO ë°”ì¸ë”© ìµœì í™” |
| 2 | [dx1 #14 `96f267e1`](https://github.com/insung52/Wicked-engine-Deep-Dive/blob/main/wicked-follow/dx_1/14_96f267e1_dynamic_depth_bias.md) | 2025-05-24 | Dynamic Depth Bias (PSO Flags) |
| 3 | [dx1 #16 `df69a706`](https://github.com/insung52/Wicked-engine-Deep-Dive/blob/main/wicked-follow/dx_1/16_df69a706_rootsig_lifetime_extender.md) | 2025-06-14 | Root Signature ìˆ˜ëª… ì—°ì¥ |
| 4 | [dx2 #16 `f0203679`](https://github.com/insung52/Wicked-engine-Deep-Dive/blob/main/wicked-follow/dx_2/16_f0203679_root_descriptor_offset.md) | 2025-11-29 | Root Descriptor buffer offset |

---

## ë³€í™” íë¦„

### 1. PSO ë°”ì¸ë”© ìµœì í™” (dx1 #11)

**ë¬¸ì œ**: PSO ìºì‹œ íˆíŠ¸ ì‹œì—ë„ ë¶ˆí•„ìš”í•œ ì‘ì—… ìˆ˜í–‰

**Static PSO ì¡°ê¸° ì¢…ë£Œ**:
```cpp
// ë³€ê²½ ì „
if (pso && pso->IsValid()) {
    active_pso = pso;
    // ê³„ì† í•´ì‹œ ê³„ì‚° ë“± ì§„í–‰...
}

// ë³€ê²½ í›„
if (pso && pso->IsValid()) {
    active_pso = pso;
    return;  // ì¡°ê¸° ì¢…ë£Œ!
}
```

**Dynamic PSO active_pso ê°±ì‹ **:
```cpp
// ë³€ê²½ ì „
if (hash == cached_hash) {
    commandlist.GetGraphicsCommandList()->SetPipelineState(cached_pso);
    // active_pso ë¯¸ê°±ì‹ ! â†’ ë‹¤ìŒ PSO ì „í™˜ ì‹œ ì˜ëª»ëœ ì°¸ì¡°
}

// ë³€ê²½ í›„
if (hash == cached_hash) {
    active_pso = &cached_pso;  // ê°±ì‹  ì¶”ê°€!
    commandlist.GetGraphicsCommandList()->SetPipelineState(cached_pso);
}
```

---

### 2. Dynamic Depth Bias (dx1 #14)

**ê°œë…**: ëŸ°íƒ€ì„ì— depth bias ë³€ê²½ ê°€ëŠ¥ (PSO ì¬ìƒì„± ì—†ì´)

**ìš”êµ¬ì‚¬í•­**:
- Agility SDK 1.608.0+
- ID3D12GraphicsCommandList9

**í˜„í™©**: WickedEngineì—ì„œ Flags í•„ë“œë§Œ ì¶”ê°€, ì‹¤ì œ ì‚¬ìš© ì•ˆ í•¨

**VizMotive**: ë¯¸ì ìš© (static depth biasë¡œ ì¶©ë¶„)

---

### 3. Root Signature ìˆ˜ëª… ì—°ì¥ (dx1 #16)

**ë¬¸ì œ**: Dangling Pointerë¡œ ì¸í•œ í¬ë˜ì‹œ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ë¬¸ì œ ì‹œë‚˜ë¦¬ì˜¤                                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  1. Shader ìƒì„±                                                 â”‚
â”‚     â””â”€â”€ rootsig_deserializer â†’ rootsig_desc ë©”ëª¨ë¦¬ ì†Œìœ         â”‚
â”‚                                                                 â”‚
â”‚  2. PSO ìƒì„±                                                    â”‚
â”‚     â””â”€â”€ rootsig_desc í¬ì¸í„° ë³µì‚¬ (ë©”ëª¨ë¦¬ ì†Œìœ  ì•ˆ í•¨)            â”‚
â”‚                                                                 â”‚
â”‚  3. Shader ì‚­ì œ (í•«ë¦¬ë¡œë“œ ë“±)                                   â”‚
â”‚     â””â”€â”€ rootsig_deserializer ì‚­ì œ â†’ rootsig_desc ë©”ëª¨ë¦¬ í•´ì œ   â”‚
â”‚                                                                 â”‚
â”‚  4. PSO ì‚¬ìš©                                                    â”‚
â”‚     â””â”€â”€ ğŸ’¥ rootsig_descê°€ dangling pointer!                    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**í•´ê²°**: `shared_ptr<void>`ë¡œ ì…°ì´ë” internal_state ì°¸ì¡°

```cpp
struct PipelineState_DX12 {
    // ê° ì…°ì´ë”ì˜ internal_stateë¥¼ ì°¸ì¡°
    std::shared_ptr<void> rootsig_desc_lifetime_extender_vs;
    std::shared_ptr<void> rootsig_desc_lifetime_extender_ps;
    // ... HS, DS, GS, MS, AS ...
};
```

**íš¨ê³¼**: ì…°ì´ë”ê°€ ì‚­ì œë˜ì–´ë„ PSOê°€ ì°¸ì¡°í•˜ëŠ” ë™ì•ˆ ë©”ëª¨ë¦¬ ìœ ì§€

---

### 4. Root Descriptor Buffer Offset (dx2 #16)

**ë¬¸ì œ**: Subresource ë°”ì¸ë”© ì‹œ buffer offset ë¬´ì‹œ

```cpp
// ë³€ê²½ ì „
commandlist->SetGraphicsRootShaderResourceView(
    slot, buffer_gpu_address);  // offset ë¬´ì‹œ!

// ë³€ê²½ í›„
commandlist->SetGraphicsRootShaderResourceView(
    slot, buffer_gpu_address + descriptor.buffer_offset);
```

**ì ìš© ëŒ€ìƒ**: SRV/UAV Root Descriptor ë°”ì¸ë”©

**ë°°ê²½**: Buffer Suballocationìœ¼ë¡œ ë‹¨ì¼ ë²„í¼ ë‚´ ì—¬ëŸ¬ ë°ì´í„° â†’ offset í•„ìˆ˜

---

## í•µì‹¬ ê°œë…

### PSOë€?

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Pipeline State Object (PSO)                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  GPU íŒŒì´í”„ë¼ì¸ ì „ì²´ ì„¤ì •ì„ ë¯¸ë¦¬ ì»´íŒŒì¼í•œ ê°ì²´                   â”‚
â”‚                                                                 â”‚
â”‚  í¬í•¨ ë‚´ìš©:                                                     â”‚
â”‚  â”œâ”€â”€ Vertex Shader                                              â”‚
â”‚  â”œâ”€â”€ Pixel Shader                                               â”‚
â”‚  â”œâ”€â”€ Rasterizer State (cull mode, fill mode...)                â”‚
â”‚  â”œâ”€â”€ Blend State                                                â”‚
â”‚  â”œâ”€â”€ Depth-Stencil State                                        â”‚
â”‚  â””â”€â”€ Root Signature                                             â”‚
â”‚                                                                 â”‚
â”‚  ì¥ì : ëŸ°íƒ€ì„ì— ìƒíƒœ ì¡°í•© ê²€ì¦ ë¶ˆí•„ìš” â†’ ë¹ ë¥¸ ë°”ì¸ë”©             â”‚
â”‚  ë‹¨ì : ì¡°í•©ë³„ë¡œ PSO ìƒì„± í•„ìš” â†’ PSO í­ë°œ ê°€ëŠ¥                   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Root Signature

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Root Signature                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ì…°ì´ë”ê°€ ì ‘ê·¼í•  ë¦¬ì†ŒìŠ¤ ë ˆì´ì•„ì›ƒ ì •ì˜                            â”‚
â”‚                                                                 â”‚
â”‚  êµ¬ì„± ìš”ì†Œ:                                                     â”‚
â”‚  â”œâ”€â”€ Root Constants: ì¦‰ì‹œ ê°’ (32-bit)                           â”‚
â”‚  â”œâ”€â”€ Root Descriptors: GPU ì£¼ì†Œ ì§ì ‘ ë°”ì¸ë”© (CBV/SRV/UAV)       â”‚
â”‚  â””â”€â”€ Descriptor Tables: í™ ë‚´ descriptor ë²”ìœ„ ì°¸ì¡°              â”‚
â”‚                                                                 â”‚
â”‚  Root Descriptor ì¥ì :                                          â”‚
â”‚  - Descriptor í™ ë¶ˆí•„ìš”                                         â”‚
â”‚  - ë°”ì¸ë”© ì˜¤ë²„í—¤ë“œ ë‚®ìŒ                                         â”‚
â”‚                                                                 â”‚
â”‚  Root Descriptor ë‹¨ì :                                          â”‚
â”‚  - 64ë¹„íŠ¸ ì£¼ì†Œ ì €ì¥ (Root ê³µê°„ ì†Œë¹„)                            â”‚
â”‚  - ë°°ì—´/í…Œì´ë¸” ë¶ˆê°€                                              â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## êµí›ˆ

### 1. ìºì‹œ íˆíŠ¸ ì‹œ ìƒíƒœ ê°±ì‹ 
PSO ìºì‹œ íˆíŠ¸í•´ë„ `active_pso` ë“± ë‚´ë¶€ ìƒíƒœ ê°±ì‹  í•„ìš”.
ì•ˆ í•˜ë©´ ë‹¤ìŒ PSO ì „í™˜ ì‹œ ì˜ëª»ëœ ì°¸ì¡° ê°€ëŠ¥.

### 2. í¬ì¸í„° ìˆ˜ëª… ê´€ë¦¬
PSOê°€ ì…°ì´ë” ë‚´ë¶€ ë©”ëª¨ë¦¬(rootsig_desc)ë¥¼ ì°¸ì¡°í•˜ë©´
ì…°ì´ë”ë³´ë‹¤ ì˜¤ë˜ ì‚´ì•„ë‚¨ì„ ìˆ˜ ìˆìŒ â†’ `shared_ptr`ë¡œ ìˆ˜ëª… ì—°ì¥.

### 3. Buffer Suballocationê³¼ Root Descriptor
Root Descriptorë¡œ ë°”ì¸ë”© ì‹œ GPU ì£¼ì†Œì— offset ë”í•´ì•¼ í•¨.
Descriptor Tableì€ SRV ìƒì„± ì‹œ offset ë°˜ì˜ë˜ì§€ë§Œ, Root DescriptorëŠ” ë³„ë„ ì²˜ë¦¬.

---

## VizMotive ì ìš©

| ì»¤ë°‹ | ì ìš© ìƒíƒœ |
|------|----------|
| dx1 #11 | âœ… PSO ë°”ì¸ë”© ìµœì í™” |
| dx1 #14 | â­ï¸ ë¯¸ì ìš© (í–¥í›„ ê²€í† ) |
| dx1 #16 | âœ… Root Signature ìˆ˜ëª… ì—°ì¥ |
| dx2 #16 | âœ… Root Descriptor offset |
