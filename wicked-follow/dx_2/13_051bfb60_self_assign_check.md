# ì»¤ë°‹ #13: 051bfb60 - Handle self-assign

## ê¸°ë³¸ ì •ë³´

| í•­ëª© | ë‚´ìš© |
|------|------|
| ì»¤ë°‹ í•´ì‹œ | `051bfb60` |
| ë‚ ì§œ | 2025-11-26 |
| ìž‘ì„±ìž | TurÃ¡nszki JÃ¡nos |
| ì¹´í…Œê³ ë¦¬ | ë²„ê·¸ìˆ˜ì • |
| ìš°ì„ ìˆœìœ„ | ë‚®ìŒ |

## ë³€ê²½ íŒŒì¼ ìš”ì•½

| íŒŒì¼ | ë³€ê²½ |
|------|------|
| wiAllocator.h | `PageAllocator::Allocation::operator=`ì— self-assign ì²´í¬ ì¶”ê°€ |

---

## ë¬¸ì œ: Self-Assignment

### Self-Assignmentëž€?

```cpp
Allocation a;
a = a;  // ìžê¸° ìžì‹ ì—ê²Œ ëŒ€ìž… (self-assign)
```

### ì™œ ë¬¸ì œì¸ê°€?

```cpp
// Self-assign ì²´í¬ ì—†ëŠ” ëŒ€ìž… ì—°ì‚°ìž
Allocation& operator=(const Allocation& other)
{
    Reset();  // ìžì‹ ì˜ ë¦¬ì†ŒìŠ¤ í•´ì œ!
    // other(=ìžì‹ )ì˜ ë¦¬ì†ŒìŠ¤ ë³µì‚¬ ì‹œë„
    // â†’ ì´ë¯¸ í•´ì œëœ ë¦¬ì†ŒìŠ¤ ì ‘ê·¼ â†’ UB!
    allocator = other.allocator;
    // ...
}
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Self-Assignment ë¬¸ì œ                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  a = a; ì‹¤í–‰ ì‹œ:                                                â”‚
â”‚                                                                 â”‚
â”‚  1. Reset() í˜¸ì¶œ â†’ aì˜ ë¦¬ì†ŒìŠ¤ í•´ì œ                              â”‚
â”‚  2. other.allocator ë³µì‚¬ ì‹œë„                                   â”‚
â”‚     â†’ otherëŠ” a ìžì‹                                             â”‚
â”‚     â†’ ì´ë¯¸ Reset()ìœ¼ë¡œ í•´ì œë¨!                                  â”‚
â”‚  3. ðŸ’¥ í•´ì œëœ ë©”ëª¨ë¦¬ ì ‘ê·¼                                       â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## í•´ê²°: Self-Assign ì²´í¬ ì¶”ê°€

```cpp
Allocation& operator=(const Allocation& other)
{
    if (&other == this) return *this;  // âœ… Self-assign ì²´í¬

    Reset();
    allocator = other.allocator;
    internal_state = other.internal_state;
    byte_offset = other.byte_offset;
    // ...
    return *this;
}
```

---

## VizMotive ì ìš© í˜„í™©

### ì´ë¯¸ ì ìš©ë¨ âœ…

VizMotiveì˜ `Allocator.h:161`ì— ì´ë¯¸ ë™ì¼í•œ self-assign ì²´í¬ê°€ ì¡´ìž¬í•©ë‹ˆë‹¤.

```cpp
// Allocator.h - PageAllocator::Allocation
Allocation& operator=(const Allocation& other)
{
    if (&other == this) return *this;  // ì´ë¯¸ ìžˆìŒ
    Reset();
    // ...
}
```

---

## ìš”ì•½

| í•­ëª© | ë‚´ìš© |
|------|------|
| ë¬¸ì œ | Self-assignment ì‹œ Reset() í›„ í•´ì œëœ ë¦¬ì†ŒìŠ¤ ì ‘ê·¼ |
| í•´ê²° | `if (&other == this) return *this;` ì²´í¬ ì¶”ê°€ |
| VizMotive | âœ… ì´ë¯¸ ì ìš©ë¨ |

### í•µì‹¬ êµí›ˆ

> **ëŒ€ìž… ì—°ì‚°ìžì—ì„œ Self-Assign ì²´í¬ëŠ” ê¸°ë³¸**
>
> ```cpp
> T& operator=(const T& other) {
>     if (&other == this) return *this;  // í•­ìƒ ì¶”ê°€!
>     // ...
> }
> ```
