# ì»¤ë°‹ #13: e6a003cd - stringconvert replacement

## ê¸°ë³¸ ì •ë³´

| í•­ëª© | ë‚´ìš© |
|------|------|
| ì»¤ë°‹ í•´ì‹œ | `e6a003cd` |
| ë‚ ì§œ | 2025-05-20 |
| ì‘ì„±ì | TurÃ¡nszki JÃ¡nos |
| ì¹´í…Œê³ ë¦¬ | ë¦¬íŒ©í† ë§ / ì•ˆì •ì„± / ë³´ì•ˆ |
| ìš°ì„ ìˆœìœ„ | ì¤‘ê°„ |

## ë³€ê²½ íŒŒì¼ ìš”ì•½

| íŒŒì¼ | ë³€ê²½ |
|------|------|
| wiHelper.h/cpp | StringConvert í•¨ìˆ˜ë“¤ ì „ë©´ êµì²´ |
| í˜¸ì¶œë¶€ ë‹¤ìˆ˜ | dest_size íŒŒë¼ë¯¸í„° ì¶”ê°€ |

---

## ë°°ê²½ ì§€ì‹: ë¬¸ìì—´ ì¸ì½”ë”©

### ASCII vs Unicode vs UTF-8

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ë¬¸ìì—´ ì¸ì½”ë”© ë¹„êµ                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ASCII (1ë°”ì´íŠ¸)                                                â”‚
â”‚  - ì˜ë¬¸ì, ìˆ«ì, ê¸°í˜¸ë§Œ í‘œí˜„ ê°€ëŠ¥                                â”‚
â”‚  - 'A' = 0x41, 'Z' = 0x5A                                       â”‚
â”‚                                                                 â”‚
â”‚  Unicode (ì½”ë“œ í¬ì¸íŠ¸)                                          â”‚
â”‚  - ì „ ì„¸ê³„ ëª¨ë“  ë¬¸ìì— ê³ ìœ  ë²ˆí˜¸ ë¶€ì—¬                            â”‚
â”‚  - 'ê°€' = U+AC00, 'ğŸ˜€' = U+1F600                                â”‚
â”‚                                                                 â”‚
â”‚  UTF-8 (ê°€ë³€ ê¸¸ì´ ì¸ì½”ë”©)                                       â”‚
â”‚  - Unicodeë¥¼ 1~4ë°”ì´íŠ¸ë¡œ ì¸ì½”ë”©                                  â”‚
â”‚  - ASCII í˜¸í™˜ (ì˜ë¬¸ìëŠ” 1ë°”ì´íŠ¸)                                 â”‚
â”‚  - í•œê¸€ì€ 3ë°”ì´íŠ¸, ì´ëª¨ì§€ëŠ” 4ë°”ì´íŠ¸                              â”‚
â”‚                                                                 â”‚
â”‚  UTF-16 / wchar_t (Windows)                                     â”‚
â”‚  - Unicodeë¥¼ 2ë°”ì´íŠ¸ ë˜ëŠ” 4ë°”ì´íŠ¸ë¡œ ì¸ì½”ë”©                       â”‚
â”‚  - Windows APIëŠ” ì£¼ë¡œ UTF-16 ì‚¬ìš©                               â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### StringConvertì˜ ì—­í• 

```cpp
// wchar_t (UTF-16) â†’ char (UTF-8)
int StringConvert(const wchar_t* from, char* to, int dest_size);

// char (UTF-8) â†’ wchar_t (UTF-16)
int StringConvert(const char* from, wchar_t* to, int dest_size);
```

**ì‚¬ìš© ì˜ˆì‹œ**:
```cpp
// Windows APIëŠ” wchar_t ì‚¬ìš©
wchar_t filename_wide[] = L"íŒŒì¼.txt";

// íŒŒì¼ ì‹œìŠ¤í…œì´ë‚˜ ë¡œê·¸ëŠ” char(UTF-8) ì‚¬ìš©
char filename_utf8[256];
StringConvert(filename_wide, filename_utf8, 256);

printf("íŒŒì¼ëª…: %s\n", filename_utf8);
```

---

## ë¬¸ì œ 1: ë²„í¼ ì˜¤ë²„í”Œë¡œìš° (dest_size = -1)

### ê¸°ì¡´ ì½”ë“œ

```cpp
// ê¸°ë³¸ê°’ -1 = "í¬ê¸° ì œí•œ ì—†ìŒ"
int StringConvert(const wchar_t* from, char* to, int dest_size = -1);
```

### ì™œ ìœ„í—˜í•œê°€?

```cpp
char buffer[10];  // 10ë°”ì´íŠ¸ ë²„í¼

// ë¬¸ì œ: dest_size ìƒëµ â†’ ê¸°ë³¸ê°’ -1 ì‚¬ìš©
StringConvert(L"ì´ê²ƒì€ ë§¤ìš° ê¸´ ë¬¸ìì—´ì…ë‹ˆë‹¤", buffer);
```

**ë‚´ë¶€ ë™ì‘**:
```cpp
int StringConvert(const wchar_t* from, char* to, int dest_size)
{
    if (dest_size == -1)
    {
        // í¬ê¸° ì œí•œ ì—†ì´ ë³µì‚¬!
        // buffer[10]ì— ìˆ˜ì‹­ ë°”ì´íŠ¸ë¥¼ ì“°ë ¤ê³  ì‹œë„
        while (*from) {
            *to++ = ConvertChar(*from++);  // ë²„í¼ ëì„ ë„˜ì–´ì„œ ê³„ì† ì”€!
        }
    }
}
```

**ê²°ê³¼**:
```
ë©”ëª¨ë¦¬ ë ˆì´ì•„ì›ƒ:

buffer[10]:     [0][1][2][3][4][5][6][7][8][9]
                 â†“  â†“  â†“  â†“  â†“  â†“  â†“  â†“  â†“  â†“
                ì´ ê²ƒ ì€   ë§¤ ìš°   ê¸´   ë¬¸ ì
                                              â†“
ë‹¤ë¥¸ ë³€ìˆ˜:                                   [ë®ì–´ì”€!] â† ë²„í¼ ì˜¤ë²„í”Œë¡œìš°
ìŠ¤íƒ í”„ë ˆì„:                                 [ë¦¬í„´ ì£¼ì†Œ ë®ì–´ì”€!] â† ë³´ì•ˆ ì·¨ì•½ì 
```

### ë²„í¼ ì˜¤ë²„í”Œë¡œìš°ì˜ ìœ„í—˜ì„±

1. **í”„ë¡œê·¸ë¨ í¬ë˜ì‹œ**: ë‹¤ë¥¸ ë³€ìˆ˜ë‚˜ ìŠ¤íƒì„ ë®ì–´ì¨ì„œ ì˜ˆì¸¡ ë¶ˆê°€ëŠ¥í•œ ë™ì‘
2. **ë³´ì•ˆ ì·¨ì•½ì **: ê³µê²©ìê°€ ì•…ì˜ì ì¸ ë¬¸ìì—´ë¡œ ë¦¬í„´ ì£¼ì†Œ ë®ì–´ì“°ê¸° ê°€ëŠ¥
3. **ë””ë²„ê¹… ì–´ë ¤ì›€**: ë²„ê·¸ ì›ì¸ì´ ì™„ì „íˆ ë‹¤ë¥¸ ê³³ì—ì„œ ë°œìƒí•œ ê²ƒì²˜ëŸ¼ ë³´ì„

### í•´ê²°: dest_size í•„ìˆ˜í™”

```cpp
// ë³€ê²½ í›„ - ê¸°ë³¸ê°’ ì—†ìŒ, ë°˜ë“œì‹œ í¬ê¸° ì§€ì •
int StringConvert(const wchar_t* from, char* to, int dest_size);

// ì‚¬ìš©
char buffer[256];
StringConvert(L"ë¬¸ìì—´", buffer, 256);  // í¬ê¸° ëª…ì‹œ í•„ìˆ˜
StringConvert(L"ë¬¸ìì—´", buffer);        // ì»´íŒŒì¼ ì—ëŸ¬!
```

**ë‚´ë¶€ ë™ì‘**:
```cpp
int StringConvert(const wchar_t* from, char* to, int dest_size)
{
    int written = 0;
    while (*from && written < dest_size - 1)  // í¬ê¸° ì œí•œ!
    {
        // ì•ˆì „í•˜ê²Œ ë³µì‚¬
        written += EncodeUTF8(*from++, to + written, dest_size - written);
    }
    to[written] = '\0';  // null ì¢…ë£Œ
    return written;
}
```

---

## ë¬¸ì œ 2: Deprecated API (std::wstring_convert)

### ê¸°ì¡´ ì½”ë“œ

```cpp
#include <codecvt>
#include <locale>

int StringConvert(const char* from, wchar_t* to, int dest_size)
{
    std::wstring_convert<std::codecvt_utf8<wchar_t>> converter;
    std::wstring result = converter.from_bytes(from);
    // ...
}
```

### ì™œ deprecatedì¸ê°€?

`std::wstring_convert`ì™€ `std::codecvt`ëŠ” C++17ì—ì„œ **deprecated** ë˜ì—ˆìŠµë‹ˆë‹¤:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              std::wstring_convertì˜ ë¬¸ì œì                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  1. ì˜ˆì™¸ ì•ˆì „ì„± ë¬¸ì œ                                             â”‚
â”‚     - ë³€í™˜ ì‹¤íŒ¨ ì‹œ ì˜ˆì™¸ ë°œìƒ                                      â”‚
â”‚     - ì˜ˆì™¸ ì²˜ë¦¬ê°€ ì–´ë µê³  ì¼ê´€ì„± ì—†ìŒ                              â”‚
â”‚                                                                 â”‚
â”‚  2. ìŠ¤ë ˆë“œ ì•ˆì „ì„± ë¬¸ì œ                                           â”‚
â”‚     - ì¼ë¶€ êµ¬í˜„ì—ì„œ ìŠ¤ë ˆë“œ ì•ˆì „í•˜ì§€ ì•ŠìŒ                          â”‚
â”‚                                                                 â”‚
â”‚  3. ì„¤ê³„ ê²°í•¨                                                    â”‚
â”‚     - ìƒíƒœë¥¼ ê°€ì§€ëŠ”(stateful) ë³€í™˜ ì²˜ë¦¬ê°€ ì–´ë ¤ì›€                  â”‚
â”‚     - ë¶€ë¶„ ë³€í™˜ ë¶ˆê°€ëŠ¥                                           â”‚
â”‚                                                                 â”‚
â”‚  4. ëŒ€ì•ˆ ë¶€ì¬ ìƒíƒœë¡œ deprecated                                  â”‚
â”‚     - C++17: deprecated                                         â”‚
â”‚     - C++26: ì œê±° ì˜ˆì •                                           â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì»´íŒŒì¼ëŸ¬ ê²½ê³ 

```
warning C4996: 'std::wstring_convert<std::codecvt_utf8<wchar_t>,wchar_t>':
warning STL4017: std::wbuffer_convert, std::wstring_convert, and the
<codecvt> header (containing std::codecvt_mode, std::codecvt_utf8,
std::codecvt_utf16, and std::codecvt_utf8_utf16) are deprecated in C++17.
```

### í•´ê²°: ì»¤ìŠ¤í…€ UTF-8 êµ¬í˜„

**deprecated API ëŒ€ì‹  ì§ì ‘ UTF-8 ì¸ì½”ë”©/ë””ì½”ë”© êµ¬í˜„**:

```cpp
// UTF-8 ì¸ì½”ë”© (wchar_t â†’ char)
int EncodeUTF8(uint32_t codepoint, char* out, int max_bytes)
{
    if (codepoint < 0x80)
    {
        // ASCII: 1ë°”ì´íŠ¸
        // 'A' (U+0041) â†’ 0x41
        if (max_bytes < 1) return 0;
        out[0] = (char)codepoint;
        return 1;
    }
    else if (codepoint < 0x800)
    {
        // 2ë°”ì´íŠ¸: 0x80 ~ 0x7FF
        // 'Ã©' (U+00E9) â†’ 0xC3 0xA9
        if (max_bytes < 2) return 0;
        out[0] = 0xC0 | (codepoint >> 6);
        out[1] = 0x80 | (codepoint & 0x3F);
        return 2;
    }
    else if (codepoint < 0x10000)
    {
        // 3ë°”ì´íŠ¸: 0x800 ~ 0xFFFF (í•œê¸€ í¬í•¨)
        // 'ê°€' (U+AC00) â†’ 0xEA 0xB0 0x80
        if (max_bytes < 3) return 0;
        out[0] = 0xE0 | (codepoint >> 12);
        out[1] = 0x80 | ((codepoint >> 6) & 0x3F);
        out[2] = 0x80 | (codepoint & 0x3F);
        return 3;
    }
    else
    {
        // 4ë°”ì´íŠ¸: 0x10000 ~ 0x10FFFF (ì´ëª¨ì§€ ë“±)
        // 'ğŸ˜€' (U+1F600) â†’ 0xF0 0x9F 0x98 0x80
        if (max_bytes < 4) return 0;
        out[0] = 0xF0 | (codepoint >> 18);
        out[1] = 0x80 | ((codepoint >> 12) & 0x3F);
        out[2] = 0x80 | ((codepoint >> 6) & 0x3F);
        out[3] = 0x80 | (codepoint & 0x3F);
        return 4;
    }
}

// UTF-8 ë””ì½”ë”© (char â†’ uint32_t)
int DecodeUTF8(const char* in, uint32_t* out_codepoint)
{
    uint8_t c = (uint8_t)in[0];

    if ((c & 0x80) == 0)
    {
        // 1ë°”ì´íŠ¸ (ASCII)
        *out_codepoint = c;
        return 1;
    }
    else if ((c & 0xE0) == 0xC0)
    {
        // 2ë°”ì´íŠ¸
        *out_codepoint = ((c & 0x1F) << 6) | (in[1] & 0x3F);
        return 2;
    }
    else if ((c & 0xF0) == 0xE0)
    {
        // 3ë°”ì´íŠ¸
        *out_codepoint = ((c & 0x0F) << 12) | ((in[1] & 0x3F) << 6) | (in[2] & 0x3F);
        return 3;
    }
    else if ((c & 0xF8) == 0xF0)
    {
        // 4ë°”ì´íŠ¸
        *out_codepoint = ((c & 0x07) << 18) | ((in[1] & 0x3F) << 12)
                       | ((in[2] & 0x3F) << 6) | (in[3] & 0x3F);
        return 4;
    }

    return 0;  // ì˜ëª»ëœ UTF-8
}
```

### ì¥ì 

1. **Deprecated ê²½ê³  ì—†ìŒ**
2. **í¬ë¡œìŠ¤ í”Œë«í¼**: ëª¨ë“  ì»´íŒŒì¼ëŸ¬ì—ì„œ ë™ì¼í•˜ê²Œ ë™ì‘
3. **ì˜ˆì™¸ ì—†ìŒ**: ì—ëŸ¬ ì‹œ ë°˜í™˜ê°’ìœ¼ë¡œ ì²˜ë¦¬
4. **ì™„ì „í•œ ì œì–´**: UTF-8 ìŠ¤í™ ì§ì ‘ êµ¬í˜„ìœ¼ë¡œ ì—£ì§€ ì¼€ì´ìŠ¤ ì²˜ë¦¬ ê°€ëŠ¥

---

## ë¬¸ì œ 3: Dangling Pointer (c_str() ë¬¸ì œ)

### ê¸°ì¡´ ì½”ë“œ (ë¹„-Windows)

```cpp
int StringConvert(const char* from, wchar_t* to, int dest_size)
{
    std::wstring_convert<std::codecvt_utf8<wchar_t>> cv;

    // ë¬¸ì œì˜ ì½”ë“œ!
    auto result = cv.from_bytes(from).c_str();

    // resultë¥¼ ì‚¬ìš©í•´ì„œ toì— ë³µì‚¬...
    wcscpy(to, result);  // ğŸ’¥ í¬ë˜ì‹œ ë˜ëŠ” ì“°ë ˆê¸°ê°’!
}
```

### ì™œ ë¬¸ì œì¸ê°€?

**ë‹¨ê³„ë³„ ë¶„ì„**:

```cpp
auto result = cv.from_bytes(from).c_str();
//            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
//            â”‚  ì´ ë¶€ë¶„ì´ ì„ì‹œ ê°ì²´
//            â”‚  (temporary object)
//            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```
1. cv.from_bytes(from)
   â†’ std::wstring ì„ì‹œ ê°ì²´ ìƒì„±
   â†’ ë‚´ë¶€ ë²„í¼: "ì•ˆë…•í•˜ì„¸ìš”" (í™ì— í• ë‹¹)

2. .c_str()
   â†’ ì„ì‹œ ê°ì²´ ë‚´ë¶€ì˜ const wchar_t* í¬ì¸í„° ë°˜í™˜
   â†’ result = ë‚´ë¶€ ë²„í¼ ì£¼ì†Œ

3. ì„¸ë¯¸ì½œë¡  (ë¬¸ì¥ ë)
   â†’ ì„ì‹œ ê°ì²´ ì†Œë©¸ì í˜¸ì¶œ!
   â†’ ë‚´ë¶€ ë²„í¼ í•´ì œ (free)
   â†’ resultê°€ ê°€ë¦¬í‚¤ëŠ” ë©”ëª¨ë¦¬ = í•´ì œëœ ë©”ëª¨ë¦¬!

4. wcscpy(to, result)
   â†’ resultëŠ” dangling pointer
   â†’ í•´ì œëœ ë©”ëª¨ë¦¬ ì½ê¸° = Undefined Behavior!
```

### ì‹œê°ì  ì„¤ëª…

```
ì‹œê°„ â†’

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ë‹¨ê³„ 1: cv.from_bytes(from) í˜¸ì¶œ                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ìŠ¤íƒ:                      í™:                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ ì„ì‹œ wstring â”‚â”€â”€â”€ptrâ”€â”€â”€â–¶â”‚ "ì•ˆë…•í•˜ì„¸ìš”\0"       â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ë‹¨ê³„ 2: .c_str() í˜¸ì¶œ                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ìŠ¤íƒ:                      í™:                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ ì„ì‹œ wstring â”‚â”€â”€â”€ptrâ”€â”€â”€â–¶â”‚ "ì•ˆë…•í•˜ì„¸ìš”\0"       â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚                        â”‚
â”‚  â”‚ result      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ë‹¨ê³„ 3: ë¬¸ì¥ ë (ì„¸ë¯¸ì½œë¡ ) - ì„ì‹œ ê°ì²´ ì†Œë©¸                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ìŠ¤íƒ:                      í™:                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ (ì†Œë©¸ë¨)    â”‚            â”‚ (í•´ì œë¨, ì“°ë ˆê¸°)    â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚                        â”‚
â”‚  â”‚ result      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â† Dangling Pointer!    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ë‹¨ê³„ 4: wcscpy(to, result) - Undefined Behavior!                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  - ìš´ì´ ì¢‹ìœ¼ë©´: ì“°ë ˆê¸°ê°’ ë³µì‚¬                                    â”‚
â”‚  - ìš´ì´ ë‚˜ì˜ë©´: í¬ë˜ì‹œ                                           â”‚
â”‚  - ìµœì•…ì˜ ê²½ìš°: ë‹¤ë¥¸ ê³³ì—ì„œ í• ë‹¹ëœ ë°ì´í„° ì½ìŒ (ë³´ì•ˆ ì·¨ì•½ì )     â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì˜¬ë°”ë¥¸ ë°©ë²•

```cpp
// ë°©ë²• 1: ì„ì‹œ ê°ì²´ë¥¼ ë³€ìˆ˜ì— ì €ì¥
std::wstring temp = cv.from_bytes(from);  // tempê°€ ì‚´ì•„ìˆëŠ” ë™ì•ˆ ìœ íš¨
const wchar_t* result = temp.c_str();
wcscpy(to, result);  // OK - tempê°€ ì•„ì§ ì‚´ì•„ìˆìŒ

// ë°©ë²• 2: í•œ ì¤„ì—ì„œ ë°”ë¡œ ë³µì‚¬
wcscpy(to, cv.from_bytes(from).c_str());  // OK - ì„ì‹œ ê°ì²´ê°€ ë¬¸ì¥ ëê¹Œì§€ ìœ íš¨
```

### í•´ê²°: ì»¤ìŠ¤í…€ êµ¬í˜„ìœ¼ë¡œ ì„ì‹œ ê°ì²´ ì œê±°

```cpp
// ë³€ê²½ í›„ - ì„ì‹œ ê°ì²´ ì—†ì´ ì§ì ‘ ë³€í™˜
int StringConvert(const char* from, wchar_t* to, int dest_size)
{
    int written = 0;
    while (*from && written < dest_size - 1)
    {
        uint32_t codepoint;
        int bytes = DecodeUTF8(from, &codepoint);
        if (bytes == 0) break;

        from += bytes;

        // ì§ì ‘ to ë²„í¼ì— ì“°ê¸° - ì„ì‹œ ê°ì²´ ì—†ìŒ!
        if (codepoint < 0x10000)
        {
            to[written++] = (wchar_t)codepoint;
        }
        else
        {
            // Surrogate pair (UTF-16)
            codepoint -= 0x10000;
            to[written++] = 0xD800 | (codepoint >> 10);
            to[written++] = 0xDC00 | (codepoint & 0x3FF);
        }
    }
    to[written] = L'\0';
    return written;
}
```

---

## VizMotive ì ìš©

### ì ìš© ì¼ì
2026-01-27

### ì ìš© ë‚´ìš©

**1. Helpers.h - StringConvert í•¨ìˆ˜ ì „ë©´ êµì²´ (~250ì¤„)**

| ë³€ê²½ ì „ | ë³€ê²½ í›„ |
|---------|---------|
| `std::wstring_convert` ì‚¬ìš© | ì»¤ìŠ¤í…€ UTF-8 ì¸ì½”ë”©/ë””ì½”ë”© |
| `dest_size = -1` ê¸°ë³¸ê°’ | í•„ìˆ˜ íŒŒë¼ë¯¸í„° |
| Windows: `MultiByteToWideChar` | í¬ë¡œìŠ¤ í”Œë«í¼ êµ¬í˜„ |
| ë¹„-Windows: deprecated API | í¬ë¡œìŠ¤ í”Œë«í¼ êµ¬í˜„ |

**2. GraphicsDevice_DX12.cpp - í˜¸ì¶œë¶€ ìˆ˜ì •**

```cpp
// ë³€ê²½ ì „ - í¬ê¸° ìƒëµ (ìœ„í—˜)
vz::helper::StringConvert(name, text);

// ë³€ê²½ í›„ - í¬ê¸° ëª…ì‹œ (ì•ˆì „)
vz::helper::StringConvert(name, text, arraysize(text));
```

ìˆ˜ì • ìœ„ì¹˜:
- `EventBegin()` (line 7996)
- `SetMarker()` (line 8014)

---

## ìš”ì•½

| ë¬¸ì œ | ì›ì¸ | í•´ê²° |
|------|------|------|
| ë²„í¼ ì˜¤ë²„í”Œë¡œìš° | `dest_size = -1` ê¸°ë³¸ê°’ | í•„ìˆ˜ íŒŒë¼ë¯¸í„°í™” |
| Deprecated ê²½ê³  | `std::wstring_convert` | ì»¤ìŠ¤í…€ UTF-8 êµ¬í˜„ |
| Dangling Pointer | ì„ì‹œ ê°ì²´ c_str() | ì§ì ‘ ë²„í¼ ì“°ê¸° |
| í”Œë«í¼ ì°¨ì´ | Windows API vs STL | í¬ë¡œìŠ¤ í”Œë«í¼ êµ¬í˜„ |

### í•µì‹¬ êµí›ˆ

> **ì„ì‹œ ê°ì²´ì˜ ìˆ˜ëª…ì„ í•­ìƒ ì˜ì‹í•˜ë¼**
>
> `temp.method().pointer()` í˜•íƒœì˜ ì½”ë“œì—ì„œ
> ì„ì‹œ ê°ì²´ëŠ” ë¬¸ì¥ ëì—ì„œ ì¦‰ì‹œ ì†Œë©¸ë¨
> â†’ ë°˜í™˜ëœ í¬ì¸í„°ëŠ” dangling pointerê°€ ë¨
